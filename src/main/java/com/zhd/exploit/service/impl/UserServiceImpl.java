package com.zhd.exploit.service.impl;

import javax.servlet.http.HttpSession;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.zhd.exploit.entity.User;
import com.zhd.exploit.enums.LoginErrorCode;
import com.zhd.exploit.mapper.UserMapper;
import com.zhd.exploit.service.UserService;
import com.zhd.exploit.utils.security.MD5Utill;

@Service
public class UserServiceImpl implements UserService {

	@Autowired
	private UserMapper userMapper;

	@Override
	public String queryUser(String username, String password, HttpSession session) {
		User user = userMapper.selectByPrimaryKey(username);
		if (user == null) {
			return LoginErrorCode.NO_USERNAME.getCode();
		}
		String encryPass = user.getPassword();
		String salt = user.getSalt();
		try {
			String pas1 = MD5Utill.md5Hex(MD5Utill.md5(salt + password));
			if (encryPass.equals(pas1)) {
				session.setAttribute("username", user.getUsername());
				return LoginErrorCode.SUCCESS.getCode();
			} else {
				return LoginErrorCode.ERR_PASS.getCode();
			}
		} catch (Exception e) {
			e.printStackTrace();
		}
		return LoginErrorCode.EXCEPT.getCode();
	}

	public static void main(String[] args) {
		String password = "123";
		String salt = "wersdfczxsc";
		try {
			String pas1 = MD5Utill.md5Hex(MD5Utill.md5(salt + password));
			System.out.println(pas1);
		} catch (Exception e) {
			e.printStackTrace();
		}
	}
}
