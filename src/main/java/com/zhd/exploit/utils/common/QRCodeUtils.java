package com.zhd.exploit.utils.common;

import java.awt.image.BufferedImage;
import java.io.File;
import java.io.InputStream;

import javax.imageio.ImageIO;

import jp.sourceforge.qrcode.QRCodeDecoder;
import jp.sourceforge.qrcode.data.QRCodeImage;

public class QRCodeUtils {
	/**
	 * 解码二维码
	 * 
	 * @param imgPath
	 * @return String
	 */
	public static String decoderQRCode(String imgPath) {

		// QRCode 二维码图片的文件
		File imageFile = new File(imgPath);

		BufferedImage bufImg = null;
		String decodedData = null;
		try {
			bufImg = ImageIO.read(imageFile);

			QRCodeDecoder decoder = new QRCodeDecoder();
			decodedData = new String(decoder.decode(new J2SEImage(bufImg)));

		} catch (Exception e) {
			e.printStackTrace();
		}
		return decodedData;
	}
	/**
	 * 解码二维码
	 * 
	 * @param imgPath
	 * @return String
	 */
	public static String decoderQRCode(InputStream inputStream) {
		
		// QRCode 二维码图片的文件
		BufferedImage bufImg = null;
		String decodedData = null;
		try {
			bufImg = ImageIO.read(inputStream);
			
			QRCodeDecoder decoder = new QRCodeDecoder();
			decodedData = new String(decoder.decode(new J2SEImage(bufImg)));
		} catch (Exception e) {
			e.printStackTrace();
		}
		return decodedData;
	}

	/**
	 * @param args
	 *            the command line arguments
	 */
	public static void main(String[] args) {
		String imgPath = "C:\\Users\\zhanghaodong\\Desktop\\789.png";
		String decoderContent = decoderQRCode(imgPath);
		System.out.println("解析结果如下：");
		System.out.println(decoderContent);
		System.out.println("========decoder success!!!");
	}
}

class J2SEImage implements QRCodeImage {
	BufferedImage bufImg;

	public J2SEImage(BufferedImage bufImg) {
		this.bufImg = bufImg;
	}

	public int getWidth() {
		return bufImg.getWidth();
	}

	public int getHeight() {
		return bufImg.getHeight();
	}

	public int getPixel(int x, int y) {
		return bufImg.getRGB(x, y);
	}

}
