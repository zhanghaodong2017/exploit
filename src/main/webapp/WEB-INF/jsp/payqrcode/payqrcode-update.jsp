<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<!DOCTYPE>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title></title>
<link
	href="${pageContext.request.contextPath}/resources/bootstrap/bower_components/bootstrap/dist/css/bootstrap.min.css"
	rel="stylesheet">
<link
	href="${pageContext.request.contextPath}/resources/bootstrap/bower_components/metisMenu/dist/metisMenu.min.css"
	rel="stylesheet">
<link
	href="${pageContext.request.contextPath}/resources/bootstrap/bower_components/morrisjs/morris.css"
	rel="stylesheet">
<link
	href="${pageContext.request.contextPath}/resources/bootstrap/bower_components/font-awesome/css/font-awesome.min.css"
	rel="stylesheet" type="text/css">
<style type="text/css">
td {
	padding: 2px;
	marign: 1px;
}

.towline {
	width: 45%;
	display: inline-block;
}
</style>
<script type="text/javascript">
	function update() {

		if ($("#note").val() == '') {
			$.MsgBox.Alert("提示", "备注不能为空");
			return;
		}
		if ($("#account").val() == '') {
			$.MsgBox.Alert("提示", "收款账户不能为空");
			return;
		}

		$("#payqrcodeForm").submit();

	}

	function cancel() {
		location.href = "${pageContext.request.contextPath}/payqrcode/queryAll";
	}
</script>


</head>
<body>
	<div id="content" style="margin-top: 2em;">
		<div id="content-header">
			<div id="breadcrumb">
				<font size="4"><span class="glyphicon glyphicon-home">修改</span></font>
			</div>
		</div>
		<hr />
		<div class="container-fluid">
			<form action="${pageContext.request.contextPath }/payqrcode/update"
				method="POST" id="payqrcodeForm">
				<div style="text-align: center; width: 100%">
					<table style="width: 800px">
						<tr>
							<td width="30%" align="right">ID<span style="color: red">*</span></td>
							<td width="70%"><input class="form-control"
								readonly="readonly" id="codeid" maxlength="225"
								name="payqrcode.codeid" value="${payqrcode.codeid}" /></td>
						</tr>
						<tr>
							<td width="30%" align="right">备注<span style="color: red">*</span></td>
							<td width="70%"><input class="form-control" id="note"
								maxlength="225" name="payqrcode.note" value="${payqrcode.note}" /></td>
						</tr>
						<tr>
							<td width="30%" align="right">二维码链接<span style="color: red">*</span></td>
							<td width="70%"><input class="form-control" id="qrcode"
								maxlength="1024" name="payqrcode.qrcode"
								value="${payqrcode.qrcode}" readonly="readonly" />
    							</td>
    							<td>
								<input type="button" value="上传二维码图片" onclick="ff.click()" class="btn btn-success"/>
    							<input type="file" id="ff" name="ff" onchange="uploadPic(this);" style="display:none"/>
								</td>
						</tr>
						<tr>
							<td width="30%" align="right">价格(分)<span style="color: red">*</span></td>
							<td width="70%"><input class="form-control" id="price"
								maxlength="10" name="payqrcode.price" value="${payqrcode.price}" /></td>
						</tr>
						<tr>
							<td width="30%" align="right">收款账户<span style="color: red">*</span></td>
							<td width="70%"><input class="form-control" id="account"
								maxlength="255" name="payqrcode.account"
								value="${payqrcode.account}" /></td>
						</tr>
						<tr>
							<td width="30%" align="right">状态<span style="color: red">*</span></td>
							<td width="70%"><select  name="payqrcode.status" id="status" class="form-control">
                                                    <option value="1">可用</option>
                                                    <option value="0">不可用</option>
                                                    <option value="2">失效</option>
                                 </select></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
						</tr>
						<tr style="height: 60px">
							<td colspan="2" width="100%" align="center">
								<table>
									<tr>
										<td><button type="button" onclick="update()"
												class="btn btn-default">提交</button></td>
										<td><button type="reset" onclick="cancel()"
												class="btn btn-default">取消</button></td>
									</tr>
								</table>
							</td>

						</tr>
					</table>
				</div>
			</form>
		</div>
	</div>
</body>
</html>

<script type="text/javascript"
	src="${pageContext.request.contextPath}/resources/bootstrap/bower_components/jquery/dist/jquery.min.js"></script>

<script type="text/javascript"
	src="${pageContext.request.contextPath}/resources/bootstrap/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

<script type="text/javascript"
	src="${pageContext.request.contextPath}/resources/bootstrap/bower_components/metisMenu/dist/metisMenu.min.js"></script>

<script type="text/javascript"
	src="${pageContext.request.contextPath}/resources/bootstrap/bower_components/raphael/raphael-min.js"></script>

<script
	src="${pageContext.request.contextPath}/resources/bootstrap/bower_components/datatables/media/js/jquery.dataTables.min.js"></script>
<script
	src="${pageContext.request.contextPath}/resources/bootstrap/bower_components/datatables-plugins/integration/bootstrap/3/dataTables.bootstrap.min.js"></script>

<script
	src="${pageContext.request.contextPath}/resources/bootstrap/js/confirm.js"></script>

<script type="text/javascript">
$(document).ready(function() {
	var status = "${payqrcode.status}";
	if(status != ''){
		$("#status").val(status);
	}
});

function uploadPic(img){
    var animateimg = $("#ff").val(); //获取上传的图片名 带//
    var imgarr=animateimg.split('\\'); //分割
    var myimg=imgarr[imgarr.length-1]; //去掉 // 获取图片名
    var houzui = myimg.lastIndexOf('.'); //获取 . 出现的位置
    var ext = myimg.substring(houzui, myimg.length).toUpperCase();  //切割 . 获取文件后缀
    
    var file = $('#ff').get(0).files[0]; //获取上传的文件
    var fileSize = file.size;           //获取上传的文件大小
    var maxSize = 10485760;              //最大10MB
    if(ext !='.PNG' && ext !='.GIF' && ext !='.JPG' && ext !='.JPEG' && ext !='.BMP'){
    	$.MsgBox.Alert("提示", "文件类型错误,请上传图片类型");
        return false;
    }else if(parseInt(fileSize) >= parseInt(maxSize)){
    	$.MsgBox.Alert("提示", "上传的文件不能超过10MB");
        return false;
    }else{
    	var formData = new FormData();
    	formData.append("file",file);
        $.ajax({
            url: "${pageContext.request.contextPath }/payqrcode/uploadQrcode", 
            type: 'POST',
            dataType: 'text',  
            cache: false,  
            processData: false,  
            async:false,
            contentType: false,
            data:formData,
            success : function(data){
            	$("#qrcode").val(data);
            }
        });
       }  
    }
</script>
