package com.zhd.exploit.utils;

import java.io.File;
import java.io.FileOutputStream;
import java.io.OutputStream;
import java.io.OutputStreamWriter;
import java.io.Writer;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import javax.management.Attribute;

import freemarker.template.Configuration;
import freemarker.template.Template;
import freemarker.template.TemplateExceptionHandler;

public class TemplateTest {
	public static final String outputFile = "D:\\temple\\";
	public static final String author = "zhanghaodong";
	public static final String packageNameRoot = "com.zhd.exploit";

	public static final String jdbc_driverClassName = "com.mysql.jdbc.Driver";
	public static final String jdbc_url = "jdbc:mysql://111.231.115.86:3306/zhd";
	public static final String jdbc_username = "root";
	

	public static void main(String[] args) throws Exception {
		String tableName = "";
		String className = "";
		// genService(tableName, className);

//		System.out.println(TemplateTest.class.getResource("/").getPath());
		JDBCUtil jdbcUtil = new JDBCUtil();
		List<Map<String, Object>> list = jdbcUtil.excuteQuery("select * from user");
		System.out.println(list);
	}

	private static void genService(String tableName, String className) throws Exception {
		// 获取首字母小写类变量
		String lowClassName = className.substring(0, 1).toLowerCase() + className.substring(1);
		// 获取主键信息

		Template serviceTemp = getTemplate("Service.ftl");
		Map<String, Object> root = new HashMap<String, Object>();
		root.put("packageNameRoot", packageNameRoot);
		root.put("author", author);
		root.put("ClassName", className);
		root.put("className", lowClassName);

		List<Attribute> attr_list = new ArrayList<Attribute>();
		attr_list.add(new Attribute("id", "Long"));
		attr_list.add(new Attribute("name", "String"));
		attr_list.add(new Attribute("age", "Integer"));
		attr_list.add(new Attribute("hobby", "List<String>"));

		root.put("attrs", attr_list);

		// Writer out = new OutputStreamWriter(System.out);
		// Writer out = new OutputStreamWriter(System.out);
		File dir = new File("E:/Work/Freemarker/src/");
		if (!dir.exists()) {
			dir.mkdirs();
		}
		OutputStream fos = new FileOutputStream(new File(dir, "Person.java")); // java文件的生成目录
		Writer out = new OutputStreamWriter(fos);
		serviceTemp.process(root, out);
		fos.flush();
		fos.close();

		System.out.println("gen code success!");
	}

	private static Template getTemplate(String tempname) {
		try {
			String path = TemplateTest.class.getResource("").getPath() + "template/";
			Configuration cfg = new Configuration(Configuration.VERSION_2_3_22);
			cfg.setDirectoryForTemplateLoading(new File(path));
			cfg.setDefaultEncoding("UTF-8");
			cfg.setTemplateExceptionHandler(TemplateExceptionHandler.RETHROW_HANDLER);
			Template temp = cfg.getTemplate(tempname);
			return temp;
		} catch (Exception e) {
			e.printStackTrace();
		}
		return null;
	}
}
